#slider
#speed_container
  Speed:
  %span#speed_value
    1
%button#start_exercise Start
#flash_reading_container
  Ready?

:javascript
  var FlashReadingTest = new Object();

  $(function() {

    // get the words
    FlashReadingTest.words = #{@flash_reading_test.content.body.split(' ').reverse.to_json};

    // instantiate the slider
    $("#slider").slider({
      min: 1,
      max: 100,
      value: 1,
      slide: function(event, ui) {
        $("#speed_value").html(ui.value);
      }
    });

    // events for <- and ->
    $(document).keydown(function(e){
      if (e.keyCode == $.ui.keyCode.LEFT) { 
        // decrease the value
        var slider = $("#slider");
        var old_value = slider.slider("value");
        slider.slider("value", old_value - 1); 

        // show the speed
        $("#speed_value").html(slider.slider("value"));
      } else if (e.keyCode == $.ui.keyCode.RIGHT) {
        // increase the value
        var slider = $("#slider");
        var old_value = slider.slider("value");
        slider.slider("value", old_value + 1); 

        // show the speed
        $("#speed_value").html(slider.slider("value"));
      }
    });

    // handler for clicking on start button
    $('#start_exercise').click(function() {
      if (FlashReadingTest.running) return;
      FlashReadingTest.running = true;
      FlashReadingTest.number_of_words = 2;
      FlashReadingTest.iterate();
    });

    // get words that need to be displayed
    FlashReadingTest.fetch_next_chunk = function() {
      var chunk = [];
      for(var i = 0; i < FlashReadingTest.number_of_words; i++) {
        chunk.push(FlashReadingTest.words.pop());
      }
      return chunk.join(' ');
    }

    // calculate delay based on speed
    FlashReadingTest.get_delay = function(){
      // 1 - 100
      var speed = parseInt($("#speed_value").html());

      // 300 - 92.1
      return 3 * ((101 - speed) * 0.7 + 30);
    }

    // display words
    FlashReadingTest.iterate = function() {
      var next_chunk = FlashReadingTest.fetch_next_chunk();
      if (next_chunk == undefined) {
        FlashReadingTest.running = false;
        FlashReadingTest.words = #{@flash_reading_test.content.body.split(' ').reverse.to_json};
        return;
      }
      $('#flash_reading_container').html(next_chunk);
      setTimeout('FlashReadingTest.iterate()', FlashReadingTest.get_delay());
    }
  });
