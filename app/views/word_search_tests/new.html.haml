This test will measure your ability to find words in the text.
= "The word is \"#{@word_search_test.word}\"."
Click the start button when you are ready and the text will appear below. Click on the word when you find it.
%button#start_reading Start
#reading_text
  = @word_search_test.content.body.gsub(/\b\w+\b/, '<span class="clickable">\0</span>').html_safe
%div

= form_for(@word_search_test) do |f|
  = f.hidden_field :content_id
  = f.hidden_field :user_id
  = f.hidden_field :score

:javascript
  $('#start_reading').click(function() {
    var text_container = $('#reading_text')
    text_container.show();
    window.start_time = new Date();
  });

  $('.clickable').click(function(e) {
    var clicked_text = $(this).text();
    var is_correct = clicked_text == "#{@word_search_test.word}";
    if (is_correct) {
      var end_time = new Date();
      var elapsed_time = (end_time - window.start_time) / 1000;
      var score = Math.round("#{@word_search_test.content.word_count}" * 100 / elapsed_time);
      $('#word_search_test_score').val(score);
      alert("Good job! It took you " + elapsed_time + " seconds! There was #{@word_search_test.content.word_count} words in this text. Your score is " + score);
      $('#new_word_search_test').submit();
    } else {
      alert("Try again");
    }
  });

  // $('#reading_text').click(function(e) {
  //   s = window.getSelection();
  //   var range = s.getRangeAt(0);
  //   var node = s.anchorNode;
  //   while (range.toString().indexOf(' ') != 0) {
  //     range.setStart(node, (range.startOffset - 1));
  //   }
  //   range.setStart(node, range.startOffset + 1);
  //   do {
  //     range.setEnd(node, range.endOffset + 1);
  //   } while (range.toString().indexOf(' ') == -1 && range.toString().trim() != '');
  //   var str = range.toString().trim();
  //   alert(str);
  // });

  // $('#finished_reading').click(function() {
  //   var end_time = new Date();
  //   var word_count = count_words($('#reading_text').text());
  //   var elapsed_time_in_seconds = (end_time - window.start_time) / 1000;
  //   var reading_speed = Math.round(word_count * 60 / elapsed_time_in_seconds);
  //   $('#reading_speed_test_wpm').val(reading_speed);
  //   $('#new_reading_speed_test').submit();
  // });
