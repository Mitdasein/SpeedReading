(function(a){a.widget("ui.rcarousel",{_create:function(){var b,c=a(this.element),d=this,e=this.options;this._checkOptionsValidity(this.options),this._createDataObject(),b=c.data("data"),c.addClass("ui-carousel").children().wrapAll("<div class='wrapper'></div>"),this._saveElements(),this._generatePages(),this._loadElements(),this._setCarouselWidth(),this._setCarouselHeight(),a(e.navigation.next).click(function(a){d.next(),a.preventDefault()}),a(e.navigation.prev).click(function(a){d.prev(),a.preventDefault()}),b.navigation.next=a(e.navigation.next),b.navigation.prev=a(e.navigation.prev),c.hover(function(){e.auto.enabled&&(clearInterval(b.interval),b.hoveredOver=!0)},function(){e.auto.enabled&&(b.hoveredOver=!1,d._autoMode(e.auto.direction))}),this._setStep(),e.auto.enabled&&this._autoMode(e.auto.direction),this._trigger("start")},_addElement:function(b,c){var d=a(this.element),e=d.find("div.wrapper"),f=this.options;b.width(f.width).height(f.height),f.orientation==="horizontal"?a(b).css("marginRight",f.margin):a(b).css({marginBottom:f.margin,"float":"none"}),c==="prev"?e.prepend(b.clone(!0,!0)):e.append(b.clone(!0,!0))},append:function(b){var c=a(this.element),d=c.data("data");b.each(function(b,c){d.paths.push(a(c))}),d.oldPage=d.pages[d.oldPageIndex].slice(0),d.appended=!0,this._generatePages()},_autoMode:function(b){var c=this.options,d=a(this.element).data("data");b==="next"?d.interval=setTimeout(a.proxy(this.next,this),c.auto.interval):d.interval=setTimeout(a.proxy(this.prev,this),c.auto.interval)},_checkOptionsValidity:function(b){var c,d=this,e="";a.each(b,function(f,g){switch(f){case"visible":if(!g||typeof g!="number"||g<=0||Math.ceil(g)-g>0)throw new Error("visible should be defined as a positive integer");break;case"step":if(!g||typeof g!="number"||g<=0||Math.ceil(g)-g>0)throw new Error("step should be defined as a positive integer");if(g>d.options.visible){for(c=1;c<=Math.floor(b.visible);c++)e+=c<Math.floor(g)?c+", ":c;throw new Error("Only following step values are correct: "+e)}break;case"width":if(!g||typeof g!="number"||g<=0||Math.ceil(g)-g>0)throw new Error("width should be defined as a positive integer");break;case"height":if(!g||typeof g!="number"||g<=0||Math.ceil(g)-g>0)throw new Error("height should be defined as a positive integer");break;case"speed":if(!g&&g!==0)throw new Error("speed should be defined as a number or a string");if(typeof g=="number"&&g<0)throw new Error("speed should be a positive number");if(typeof g=="string"&&g!=="slow"&&g!=="normal"&&g!=="fast")throw new Error('Only "slow", "normal" and "fast" values are valid');break;case"navigation":if(!g||a.isPlainObject(g)===!1)throw new Error("navigation should be defined as an object with at least one of the properties: 'prev' or 'next' in it");if(g.prev&&typeof g.prev!="string")throw new Error("navigation.prev should be defined as a string and point to '.class' or '#id' of an element");if(g.next&&typeof g.next!="string")throw new Error(" navigation.next should be defined as a string and point to '.class' or '#id' of an element");break;case"auto":if(typeof g.direction!="string")throw new Error("direction should be defined as a string");if(g.direction!=="next"&&g.direction!=="prev")throw new Error("direction: only 'right' and 'left' values are valid");if(isNaN(g.interval)||typeof g.interval!="number"||g.interval<0||Math.ceil(g.interval)-g.interval>0)throw new Error("interval should be a positive number");break;case"margin":if(isNaN(g)||typeof g!="number"||g<0||Math.ceil(g)-g>0)throw new Error("margin should be a positive number")}})},_createDataObject:function(){var b=a(this.element);b.data("data",{paths:[],pathsLen:0,pages:[],lastPage:[],oldPageIndex:0,pageIndex:0,navigation:{},animated:!1,appended:!1,hoveredOver:!1})},_generatePages:function(){function g(){d.pages=[],d.lastPage=[],d.pages[0]=[];for(var a=f-1;a>=f-e;a--)d.lastPage.unshift(d.paths[a]);for(var a=0;a<e;a++)d.pages[0][d.pages[0].length]=d.paths[a]}function h(a){var b=!1;for(var c=0;c<d.lastPage.length;c++){if(d.lastPage[c].get(0)!==a[c].get(0)){b=!1;break}b=!0}return b}function i(a,b,c){var e=c||d.pages.length;c||(d.pages[e]=[]);for(var f=a;f<b;f++)d.pages[e].push(d.paths[f]);return e}function j(){var a=!0,b=!1,g=c.step,j,k,l,m;while(!h(d.pages[d.pages.length-1])||a)a=!1,j=g+e,j>f&&(j=f),j-g<e?b=!0:b=!1,b?(l=g-(e-(j-g)),m=l+(e-(j-g)),k=i(l,m),i(g,j,k)):(i(g,j),g+=c.step)}var b=this,c=this.options,d=a(this.element).data("data"),e=c.visible,f=d.paths.length;g(),j()},getCurrentPage:function(){var b=a(this.element).data("data");return b.pageIndex+1},getTotalPages:function(){var b=a(this.element).data("data");return b.pages.length},goToPage:function(b){var c,d=a(this.element).data("data");!d.animated&&b!==d.pageIndex&&(d.animated=!0,b>d.pages.length-1?b=d.pages.length-1:b<0&&(b=0),d.pageIndex=b,c=b-d.oldPageIndex,c>=0?this._goToNextPage(c):this._goToPrevPage(c),d.oldPageIndex=b)},_loadElements:function(b,c){var d=this.options,e=a(this.element).data("data"),f=c||"next",g=b||e.pages[d.startAtPage],h=0,i=g.length;if(f==="next")for(var j=h;j<i;j++)this._addElement(g[j],f);else for(var j=i-1;j>=h;j--)this._addElement(g[j],f)},_goToPrevPage:function(b){var c,d,e,f,g,h,i,j,k,l=a(this.element),m=this,n=this.options,o=a(this.element).data("data");o.appended?d=o.oldPage:d=o.pages[o.oldPageIndex],f=o.oldPageIndex+b,c=o.pages[f].slice(0),a(c).each(function(b,c){c.get(0)===a(d[b]).get(0)?k=!0:k=!1}),o.appended&&k&&(o.pageIndex===0?f=o.pageIndex=o.pages.length-1:f=--o.pageIndex,c=o.pages[f].slice(0)),h=c[c.length-1].get(0);for(var p=d.length-1;p>=0;p--){if(h===a(d[p]).get(0)){i=!1,j=p;break}i=!0}if(!i)while(j>=0)c[c.length-1].get(0)===d[j].get(0)&&c.pop(),--j;m._loadElements(c,"prev"),e=n.width*c.length+n.margin*c.length,n.orientation==="horizontal"?(g={scrollLeft:0},l.scrollLeft(e)):(g={scrollTop:0},l.scrollTop(e)),l.animate(g,n.speed,function(){m._removeOldElements("last",c.length),o.animated=!1,!o.hoveredOver&&n.auto.enabled&&(clearInterval(o.interval),m._autoMode(n.auto.direction)),m._trigger("pageLoaded",null,{page:f})}),o.appended=!1},_goToNextPage:function(b){var c,d,e,f,g,h,i,j,k,l=a(this.element),m=this.options,n=l.data("data"),o=this;n.appended?d=n.oldPage:d=n.pages[n.oldPageIndex],f=n.oldPageIndex+b,c=n.pages[f].slice(0),a(c).each(function(b,c){c.get(0)===a(d[b]).get(0)?k=!0:k=!1}),n.appended&&k&&(c=n.pages[++n.pageIndex].slice(0)),h=c[0].get(0);for(var p=0;p<c.length;p++){if(h===a(d[p]).get(0)){i=!1,j=p;break}i=!0}if(!i)while(j<d.length)c[0].get(0)===d[j].get(0)&&c.shift(),++j;this._loadElements(c,"next"),e=m.width*c.length+m.margin*c.length,m.orientation==="horizontal"?g={scrollLeft:"+="+e}:g={scrollTop:"+="+e},l.animate(g,m.speed,function(){o._removeOldElements("first",c.length),m.orientation==="horizontal"?l.scrollLeft(0):l.scrollTop(0),n.animated=!1,!n.hoveredOver&&m.auto.enabled&&(clearInterval(n.interval),o._autoMode(m.auto.direction)),o._trigger("pageLoaded",null,{page:f})}),n.appended=!1},next:function(){var b=this.options,c=a(this.element).data("data");c.animated||(c.animated=!0,c.appended||++c.pageIndex,c.pageIndex>c.pages.length-1&&(c.pageIndex=0),this._goToNextPage(c.pageIndex-c.oldPageIndex),c.oldPageIndex=c.pageIndex)},prev:function(){var b=this.options,c=a(this.element).data("data");c.animated||(c.animated=!0,c.appended||--c.pageIndex,c.pageIndex<0&&(c.pageIndex=c.pages.length-1),this._goToPrevPage(c.pageIndex-c.oldPageIndex),c.oldPageIndex=c.pageIndex)},_removeOldElements:function(b,c){var d=a(this.element);for(var e=0;e<c;e++)b==="first"?d.find("div.wrapper").children().first().remove():d.find("div.wrapper").children().last().remove()},_saveElements:function(){var b,c=a(this.element),d=c.find("div.wrapper").children(),e=c.data("data");d.each(function(c,d){b=a(d),e.paths.push(b.clone(!0,!0)),b.remove()})},_setOption:function(b,c){var d,e=this.options,f=a(this.element).data("data");switch(b){case"speed":this._checkOptionsValidity({speed:c}),e.speed=c,a.Widget.prototype._setOption.apply(this,arguments);break;case"auto":d=a.extend(e.auto,c),this._checkOptionsValidity({auto:d}),e.auto.enabled&&this._autoMode(e.auto.direction)}},_setStep:function(b){var c,d=this.options,e=a(this.element).data("data");c=b||d.step,d.step=c,e.step=d.width*c},_setCarouselHeight:function(){var b,c=a(this.element),d=a(this.element).data("data"),e=this.options;e.orientation==="vertical"?b=e.visible*e.height+e.margin*(e.visible-1):b=e.height,c.height(b)},_setCarouselWidth:function(){var b,c=a(this.element),d=this.options,e=a(this.element).data("data");d.orientation==="horizontal"?b=d.visible*d.width+d.margin*(d.visible-1):b=d.width,c.css({width:b,overflow:"hidden"})},options:{visible:3,step:3,width:100,height:100,speed:1e3,margin:0,orientation:"horizontal",auto:{enabled:!1,direction:"next",interval:5e3},startAtPage:0,navigation:{next:"#ui-carousel-next",prev:"#ui-carousel-prev"}}})})(jQuery)